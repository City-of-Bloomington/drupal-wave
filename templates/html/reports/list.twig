{#
 * @copyright 2026 City of Bloomington, Indiana
 * @license http://www.gnu.org/licenses/agpl.txt GNU/AGPL, see LICENSE
 * @param array  reports   result rows
 * @param array  search    search parameters
 * @param int    total
 * @param int    itemsPerPage
 * @param int    currentPage
 * @param string DRUPAL_SITE
 * @param int    credits       WAVE credits remaining
 * @param array  departments   Drop down list of departments
 * @param array  yesno         Yes/No options for errors
 #}
{% extends "html/layouts/default.twig" %}
{% import  "html/macros/pagination.twig" as pagination %}
{% import  "html/macros/forms.twig"      as forms      %}
{% block content %}
<section>
    <header><h1>Reports</h1></header>
    <p>These are the latest results from automated WAVE scans of the city website.</p>

    <form class="usa-form">
        <fieldset class="usa-fieldset">
            <legend class="usa-legend">Search parameters</legend>
            {{ forms.field_text  ('path',       'path',       'Path',       search.path       ?? '' ) }}
            {{ forms.field_text  ('username',   'username',   'Username',   search.username   ?? '' ) }}
            {{ forms.field_select('department', 'department', 'Department', search.department ?? '', departments, false, { onchange:'this.form.submit();' } ) }}
            {{ forms.field_select('errors',     'errors',     'Has Errors', search.errors     ?? '', yesno,       false, { onchange:'this.form.submit();' } ) }}
            {{ forms.button('submit', 'Search', 'search') }}
        </fieldset>
    </form>

    <table>
    <thead>
        <tr><th>Page</th>
            <th>Errors</th>
            <th>Contrast</th>
            <th>User</th>
            <th>Department</th>
            <th>Scanned</th>
        </tr>
    </thead>
    <tbody>
        {% for r in reports %}
        <tr><td><a href="{{ DRUPAL_SITE }}{{ r.path }}">{{ r.path }}</a></td>
            <td>{{ r.error    ? r.error    : '' }}</td>
            <td>{{ r.contrast ? r.contrast : '' }}</td>
            <td>{{ r.username   }}</td>
            <td>{{ r.department }}</td>
            <td>{{ r.created | date('n/j/Y') }}</td>
        </tr>
        {% endfor %}
    </tbody>
    </table>

    {% if total > itemsPerPage %}
        {{ pagination.pageLinks(REQUEST.uri.path, search, total, itemsPerPage, currentPage) }}
    {% endif %}

    <p>Credits remaining: {{ credits }}</p>
</section>
{% endblock %}
